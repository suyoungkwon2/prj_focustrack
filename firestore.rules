rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // users 컬렉션 아래의 모든 하위 컬렉션에 대한 공통 규칙 적용 가능
    // 또는 각 하위 컬렉션별로 명시적 규칙 정의

    // tenMinutesBlock 규칙 (읽기 권한 강화 권장)
    match /users/{userId}/tenMinutesBlock/{blockId} {
      // allow read: if true; // 이전 규칙
      allow read: if request.auth != null && request.auth.uid == userId; // 수정 권장
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // dailylog 규칙 (읽기 권한 강화 권장)
    match /users/{userId}/dailylog/{logId} {
      // allow read: if true; // 이전 규칙
      allow read: if request.auth != null && request.auth.uid == userId; // 수정 권장
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // focusSessions 규칙 (기존 규칙 유지 - 문제 없음)
    match /users/{userId}/focusSessions/{sessionId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // --- classed 컬렉션 규칙 추가 ---
    match /users/{userId}/classed/{classId} {
      // 로그인한 사용자가 자신의 classed 데이터 읽기 허용
      allow read: if request.auth != null && request.auth.uid == userId;
      // 쓰기 권한은 필요에 따라 추가 (예: 백엔드에서만 쓰거나, 사용자가 직접 쓸 수도 있음)
      // allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    
    // FocusScore 컬렉션 규칙 추가
    match /users/{userId}/FocusScore/{scoreId} {
      // 로그인한 사용자가 자신의 FocusScore 데이터 읽기 허용
      allow read: if request.auth != null && request.auth.uid == userId;
      // 쓰기 권한은 현재 Cloud Function에서만 수행하므로 별도 규칙 불필요 (필요시 추가)
      // allow write: ... 
      }
    
    // ----------------------------------

    // users_list 규칙 (기존 규칙 유지)
    match /users_list/{userId} {
      allow create, update: if request.auth != null && request.auth.uid == userId;
      allow read: if request.auth != null;
    }

    // /users/{userId} 문서 자체 규칙 (기존 규칙 유지)
    match /users/{userId} {
       allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // 다른 컬렉션 규칙...
  }
}